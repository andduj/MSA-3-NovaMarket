http {
    upstream logistics_backend {
        server logistics.company.com max_fails=5 fail_timeout=30s;
    }

    server {
        listen 8080;

        location /logistics/ {
            proxy_pass http://logistics_backend;
            proxy_connect_timeout 3s;  # исправлен таймаут
            proxy_read_timeout 3s;     # исправлен таймаут
            
            # Обработка ошибок для circuit breaker
            proxy_intercept_errors on;
            error_page 502 503 504 = @fallback;
        }

        # Fallback ответ при ошибках
        location @fallback {
            return 503 '{"error": "Service temporarily unavailable", "message": "Logistics service is currently experiencing issues. Please try again later."}';
            add_header Content-Type application/json;
        }
    }
}